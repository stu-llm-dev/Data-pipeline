
# Thai Text Cleaning Pipeline ‚Äî README

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå **`Pipeline_clean.py`** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏•‡πÑ‡∏Å PDPA, Thai NER, ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ú‡∏™‡∏°, ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏£‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏£‡∏∞‡∏•‡∏≠‡∏¢

> ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏ö‡∏ô Bash/PowerShell ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡πÉ‡∏ô `"` ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô `python "Pipeline_clean.py" ...`

---

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á (‡∏¢‡πà‡∏≠)
- Python 3.9+
- ‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô): `tqdm`, `regex`, `transformers`, `torch` (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Thai NER), `fasttext` (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)
- ‡πÇ‡∏°‡πÄ‡∏î‡∏• Thai NER ‡πÅ‡∏ö‡∏ö local (‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô `THAI_NER_PATH` ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î)

---

## ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï/‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï
- **‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï**: ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå `*.jsonl` (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏•‡∏≤‡∏¢‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `--pattern`)
- **‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ `--text-keys` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏î‡∏≤ key ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô `text`, `content`, `body`, `ocr_text` ‡∏Ø‡∏•‡∏Ø; ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ `--combine-keys` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- **‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï**: ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á `--out` ‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏ç‡πà ‡πÄ‡∏ä‡πà‡∏ô
  - `legal.jsonl` / `illegal.jsonl` (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)
  - ‡πÑ‡∏ü‡∏•‡πå‡∏¢‡πà‡∏≠‡∏¢/‡πÑ‡∏ü‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞ `summary.txt` (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•)
- ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö **checkpoint/resume** ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á `--no-resume` ‡∏´‡∏£‡∏∑‡∏≠ `--clear-ckpt` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà

---

## Quickstart

```bash
python "Pipeline_clean.py" \
  --input data/ \
  --pattern "*.jsonl" \
  --out runs/exp1 \
  --workers 4 --chunk-size 200 --save-every 5 \
  --clean-steps "html,bbcode,emoticon,links,social" \
  --pdpa-policy mask \
  --pdpa-steps "name,email,phone,links,card,account,address" \
  --keep-last 4 \
  --addr-gazetteer thai_provinces_districts.json \
  --thai-ner-full \
  --thai-ner-policy mask \
  --thai-ner-cats "PERSON,PHONE,EMAIL,ADDRESS,NATIONAL_ID,HOSPITAL_IDS" \
  --detect-mixed-script --mixed-policy tag \
  --thai-mark-fix --floating-policy drop --normalize NFC \
  --flags-key "__flags"
```

### ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Thai NER ‡πÅ‡∏ö‡∏ö‡πÅ‡∏°‡∏õ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏ô
```bash
python "Pipeline_clean.py" \
  -i data/ -o runs/exp2 --pattern "*.jsonl" \
  --thai-ner-full --thai-ner-policy anonymize \
  --thai-ner-map path/to/token_map.json
```

### ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà/‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
```bash
# ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏•‡πâ‡∏≤‡∏á checkpoint
python "Pipeline_clean.py" -i data -o runs/exp3 --clear-ckpt --no-resume

# ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô output ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (append)
python "Pipeline_clean.py" -i data -o runs/exp4 --append-out
```

---

## ‡∏≠‡∏≤‡∏£‡πå‡∏Å‡∏¥‡∏ß‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å

### ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- `-i, --input`: ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï
- `--pattern`: ‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå (‡πÄ‡∏ä‡πà‡∏ô `"*.jsonl"`) ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô `*.jsonl`
- `-o, --out`: ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
- `--append-out`: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï‡πÄ‡∏î‡∏¥‡∏°
- `--workers`: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô worker ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- `--chunk-size`: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô
- `--save-every`: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ó‡∏∏‡∏Å ‡πÜ N ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ resume ‡πÑ‡∏î‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)
- `--resume` / `--no-resume`: ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å checkpoint (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î)
- `--clear-ckpt`: ‡∏•‡∏ö checkpoint ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
- `--dry-run`: ‡πÇ‡∏´‡∏°‡∏î‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏£‡∏¥‡∏á)
- `--debug-first-n`: ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ N ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å (‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏≠‡∏á‡∏Ç‡∏≠‡∏á)
- `--debug-show-diff`: ‡πÅ‡∏™‡∏î‡∏á diff ‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- `--text-keys "k1,k2,..."`: ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏µ‡∏¢‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- `--combine-keys "k1,k2,..."`: ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô sanitize/clean ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
- `--clean-steps`: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÄ‡∏ä‡πà‡∏ô `html,bbcode,emoticon,links,social`
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏ô‡∏ß `remove_*` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÄ‡∏ä‡πà‡∏ô `remove_html`, `remove_emails`

### PDPA
- `--pdpa-policy`: `skip | mask | anonymize | drop`  
- `--pdpa-steps`: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô `name,email,phone,links,card,account,address,id_card`
- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°:
  - `--keep-last`: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î mask (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏±‡∏ï‡∏£/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)
  - `--card-mode`, `--account-mode`: ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤/‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
  - `--pdpa-salt`: seed noise ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ anonymize ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
  - `--addr-gazetteer`: ‡πÑ‡∏ü‡∏•‡πå gazetteer ‡πÑ‡∏ó‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö/‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
  - `--no-addr-keep-province`: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠ anonymize
  - `--addr-tag`: ‡πÅ‡∏ó‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mask ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô `[ADDRESS]`)

### Thai NER (‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
- `--thai-ner-full`: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ NER ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
- `--thai-ner-policy`: `mask | anonymize`
- `--thai-ner-cats`: ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô `PERSON,PHONE,EMAIL,ADDRESS,NATIONAL_ID,HOSPITAL_IDS`
- `--thai-ner-map`: ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏°‡∏õ‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô (‡πÄ‡∏ä‡πà‡∏ô mapping ‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î anonymize

> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•/‡πÇ‡∏°‡πÄ‡∏î‡∏• NER ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ú‡∏™‡∏° + ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏ó‡∏¢
- `--detect-mixed-script`: ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡πÑ‡∏ó‡∏¢‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö Latin/‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô/‡∏à‡∏µ‡∏ô
- `--mixed-policy`: `skip | tag` (‡∏ñ‡πâ‡∏≤ `tag` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏î‡∏ò‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `--flags-key`)
- `--thai-mark-fix`: ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ **‡∏™‡∏£‡∏∞‡∏•‡∏≠‡∏¢**, ‡∏î‡∏∂‡∏á‡∏™‡∏£‡∏∞‡∏Å‡∏•‡∏±‡∏ö, ‡∏•‡∏ö/‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏≠‡∏¢, ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ã‡πâ‡∏≥
- `--floating-policy`: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∞‡∏ó‡∏µ‡πà‡∏•‡∏≠‡∏¢ `drop | mask | keep`
- `--pull-back-gap`: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö `any | tight`
- `--normalize`: ‡∏õ‡∏£‡∏±‡∏ö normalization `NFC | NFKC | none`
- `--flags-key`: ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡πÉ‡∏ô‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏ò‡∏á ‡πÄ‡∏ä‡πà‡∏ô `"__flags"`

### ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á fastText (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- `--fasttext-model PATH`: ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• fastText ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å legal/illegal
- `--no-fasttext`: ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ fastText

### ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- `--public-figure-files`: ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î false positive
- `--no-public-figure-skip`: ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô PDPA

```bash
# ‡πÇ‡∏´‡∏°‡∏î mask ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡πâ‡∏≤‡∏¢ 4 ‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏õ‡πá‡∏ô [ADDRESS]
python "Pipeline_clean.py" -i data -o runs/mask \
  --pdpa-policy mask \
  --pdpa-steps "name,email,phone,links,card,account,address" \
  --keep-last 4 --addr-tag "[ADDRESS]"

# ‡πÇ‡∏´‡∏°‡∏î anonymize ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
python "Pipeline_clean.py" -i data -o runs/anon \
  --pdpa-policy anonymize \
  --pdpa-steps "name,email,phone,card,account,address,id_card" \
  --pdpa-salt mysecret --addr-gazetteer thai_provinces_districts.json

# ‡πÇ‡∏´‡∏°‡∏î drop (‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•/‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå/‡∏•‡∏¥‡∏á‡∏Å‡πå + ‡∏•‡∏ö‡πÅ‡∏ó‡πá‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å mask ‡∏≠‡∏≠‡∏Å
python "Pipeline_clean.py" -i data -o runs/drop \
  --pdpa-policy drop \
  --pdpa-steps "email,phone,links,card,account,address,id_card"
```

---

## ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
- ‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≤‡∏¢ GPU: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `CUDA_VISIBLE_DEVICES=0,1` ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö `--workers`
- ‡∏õ‡∏£‡∏±‡∏ö `--chunk-size` ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÉ‡∏ä‡πâ `--debug-first-n` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

---

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠
- `legal.jsonl` / `illegal.jsonl` ‚Äî ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡∏∞ 1 ‡πÄ‡∏£‡πá‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏î (JSON) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î
- `summary.txt` ‚Äî ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏£‡∏∏‡∏õ (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡πá‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏î, ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô, ‡∏Ø‡∏•‡∏Ø)
- ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ resume/merge ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï (JSONL)

```json
{"id": "001", "text": "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏û‡∏á‡∏®‡∏Å‡∏£ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà 081-234-5678 ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏• test@example.com"}
{"id": "002", "content": "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: 123 ‡∏ñ.‡∏™‡∏≤‡∏ó‡∏£ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110"}
```

## ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
- **Thai NER ‡∏ä‡πâ‡∏≤‡πÑ‡∏õ?** ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ `--thai-ner-full` ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏ô‡∏ö‡∏ô GPU
- **mask ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏≠‡∏î‡∏µ?** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `--thai-ner-cats` ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î `--thai-mark-fix` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á token/‡∏™‡∏£‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

---

# ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á: ‡∏Å‡∏≤‡∏£‡∏´‡∏≤ Context Length ‡πÅ‡∏•‡∏∞ Overlap ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

## ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ context length ‡πÅ‡∏•‡∏∞ overlap ratio ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô Perplexity (PPL) ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÇ‡∏î‡∏¢‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á **‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (runtime)** ‡πÅ‡∏•‡∏∞ **‡∏Ñ‡πà‡∏≤ PPL ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏Å‡∏ï‡∏¥** (normal distribution)

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á
- **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô tokens ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô**: 28,510,680 tokens ‡∏ó‡∏∏‡∏Å configuration
- **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô samples**: 143 samples
- **Context lengths ‡∏ó‡∏µ‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö**: 3200, 4000, 6400, 8000, 16000, 32000
- **Overlap ratios ‡∏ó‡∏µ‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö**: 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8

## ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏° Domain

### üìä **‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1: No Outliers (‡∏Ñ‡πà‡∏≤ PPL ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô)**

‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 6 domains ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ PPL ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô:

| Domain | MIN | MAX | AVG | STDEV |
|--------|-----|-----|-----|-------|
| **‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤** (Wikipedia) | 8.34 | 32.65 | 22.44 | 5.99 |
| **‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå** | 8.69 | 37.09 | 27.11 | 6.59 |
| **‡∏Ç‡πà‡∏≤‡∏ß** (TPBS + Prachathai) | 27.79 | 109.23 | 81.26 | 19.59 |
| **‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢** (Wongnai) | 7.55 | 28.99 | 21.53 | 5.31 |
| **‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß** | 8.06 | 30.99 | 22.70 | 5.54 |
| **‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô** (SCB) | 8.42 | 32.34 | 23.88 | 5.76 |
| **‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£** (Parliament) | 11.22 | 39.10 | 28.79 | 6.83 |

### ‚ö†Ô∏è **‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2: Outliers (‡∏Ñ‡πà‡∏≤ PPL ‡∏™‡∏π‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥)**

‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 2 domains ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ PPL ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

| Domain | MIN | MAX | AVG | STDEV |
|--------|-----|-----|-----|-------|
| **‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢** (SupremeCourt) | 477.58 | 1804.53 | 1342.59 | 323.90 |
| **Code** (CodeGen) | 529.39 | 2004.35 | 1491.86 | 359.87 |

---

## üéØ ‡∏Ñ‡πà‡∏≤ Configuration ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### **‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° No Outliers**

#### ‚úÖ **Configuration ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** (Balanced: Speed + PPL Quality)

| Context Length | Overlap | Avg Runtime | PPL Range (Macro) | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|----------------|---------|-------------|-------------------|----------|
| **6400** | **0.8** | **32.58 sec** | **18.48 - 21.77** | ‚≠ê **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥**: ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î + PPL ‡∏ï‡πà‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ |
| **8000** | **0.2-0.6** | **18-45 sec** | **15.47 - 17.60** | ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å + PPL ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà overlap ‡∏ô‡πâ‡∏≠‡∏¢ |
| **6400** | **0.2-0.7** | **31-36 sec** | **18.48 - 19.81** | ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏î‡∏µ |

#### üêå **Configurations ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á** (‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)

- **Context 3200-4000** + **Overlap ‚â• 0.5**: runtime > 200 sec
- **Context 8000** + **Overlap ‚â• 0.65**: runtime > 340 sec  
- **Context 16000**: runtime 211-632 sec (‡∏ä‡πâ‡∏≤‡∏°‡∏≤‡∏Å)
- **Context 32000**: runtime 178-237 sec ‡πÅ‡∏ï‡πà PPL ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ (‡∏°‡∏µ outliers ‡∏°‡∏≤‡∏Å)

---

### **‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏° Outliers (‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ & Code)**

#### ‚úÖ **Configuration ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°**

| Context Length | Overlap | Avg Runtime | PPL Range (Macro) | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|----------------|---------|-------------|-------------------|----------|
| **6400** | **0.8** | **36-38 sec** | **1118-1244** | ‚≠ê ‡πÄ‡∏£‡πá‡∏ß + PPL ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° |
| **8000** | **0.6-0.8** | **40-592 sec** | **986-1097** | PPL ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏ä‡πâ‡∏≤ |
| **4000** | **0.7-0.8** | **32-47 sec** | **1256-1405** | ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà PPL ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ |

#### ‚ö†Ô∏è **Configurations ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á**

- **Context 32000** + **Overlap 0.4-0.55**: PPL ‡∏ï‡πà‡∏≥‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (529-746) ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å noise
- **Context 16000-32000**: PPL ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (1400-2000+) ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

---

## üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

### **Normal Distribution Analysis**

‡πÉ‡∏ä‡πâ Z-score ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ä‡πà‡∏ß‡∏á PPL:
- **‚àí1 ‚â§ Z ‚â§ +1**: ‡∏Ñ‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) ‚úÖ
- **Z < -2**: Outlier ‡∏ï‡πà‡∏≥‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÅ‡∏î‡∏á) ‚ùå  
- **Z > +2**: Outlier ‡∏™‡∏π‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÅ‡∏î‡∏á) ‚ùå

### **Key Findings**

1. **Context Length 6400-8000** ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û PPL
2. **Overlap 0.2-0.6** ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡πá‡∏ß
3. **Overlap 0.7-0.8** ‡πÉ‡∏´‡πâ PPL ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
4. **Context 32000** ‡∏°‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ overlap 0.4-0.75
5. **Domain ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞ Code** ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ context ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô

---

## üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### **‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production Use**
```
Context Length: 6400
Overlap: 0.8 (80%)
Expected Runtime: ~33 sec per 28M tokens
Expected PPL Range: 18-22 (general domains), 1100-1250 (law/code)
```

### **‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Quick Evaluation**
```
Context Length: 8000
Overlap: 0.2-0.4 (20-40%)
Expected Runtime: ~18-40 sec per 28M tokens
Expected PPL Range: 15-18 (general domains), 986-1120 (law/code)
```

### **‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö High Accuracy**
```
Context Length: 8000
Overlap: 0.75-0.8 (75-80%)
Expected Runtime: ~435-531 sec per 28M tokens
Expected PPL Range: 15.47-16.61 (most stable)
```

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡∏Ñ‡πà‡∏≤ runtime ‡∏≠‡∏≤‡∏à‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏Æ‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
- PPL ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô context 32000 ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å overfitting ‡∏´‡∏£‡∏∑‡∏≠ noise ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô production

